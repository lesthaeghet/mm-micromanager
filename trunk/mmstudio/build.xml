<!-- Ant makefile for the Micro-Manager Studio                   -->
<!-- This file assumes Micro-Manager project tree structure      -->

<project name="MMJ" default="buildMMStudio">
   <!-- EDIT PATHS BELOW TO MATCH YOUR SYSTEM -->
	
	<!-- Specify the system path to the ImageJ root directory -->
	<property name="ImageJPath" value="C:/Program Files/ImageJ"/>
	
	<!-- Specify the system path to the beanshell jar -->
	<property name="beanshell" 	value="C:/projects/3rdparty/BeanShell/bsh-2.0b4.jar"/>
	
	<!-- DO NOT MODIFY FROM THIS POINT ON -->
	
	<property name="MMPluginDir" 	value="${ImageJPath}/plugins/Micro-Manager"/>
	<property name="IJ"        	value="${ImageJPath}/ij.jar"/>
	<property name="MMCoreJ"   	value="../bin/MMCoreJ.jar"/>
	<property name="BinRoot"   	value="../bin"/>
	<property name="NativeRoot" 	value="../MMCoreJ_wrap"/>

	<path id="project.MMPlugins.path">
		<pathelement location="${MMPluginDir}"/>
	</path>

	<path id="project.class.path">
		<pathelement location="${IJ}" />
		<pathelement location="${beanshell}" />
		<pathelement location="${MMCoreJ}" />
	   <pathelement location="${MMPluginDir}/MMJ_.jar"/>
	</path>

	<target name="compileMMStudio" description="Compile MM Studio.">
		<mkdir dir="build" />
		<javac srcdir="./src" destdir="./build" optimize="on" source="5.0" debug="off">
			<classpath refid="project.class.path" />
		</javac>
		<copy file="./src/org/micromanager/icons/splash.gif" todir="./build/org/micromanager/icons" />
		<copy todir="./build/org/micromanager/icons">
			<fileset dir="./src/org/micromanager/icons" casesensitive="no">
				<include name="**/*.png"/>
				<include name="**/*.gif"/>
			</fileset>
		</copy>
	</target>

	<target name="buildMMStudio" description="Build MMJ_.jar" depends="compileMMStudio">

		<copy file="./bin/plugins_mmstudio.config" tofile="./build/plugins.config"  overwrite="true" verbose="true" />
		<jar jarfile="MMJ_.jar" basedir="build" manifest="./src/MANIFEST.MF" />
		
		<mkdir dir="${MMPluginDir}" />
		<copy file="MMJ_.jar" todir="${MMPluginDir}" />
		<copy file="${beanshell}" todir="${MMPluginDir}" />
		<copy file="${MMCoreJ}" todir="${MMPluginDir}" />
	</target>
	
	<target name="cleanMMStudio" description="Delete the MMStudio build files.">
		<delete dir="build" />
		<delete file="MMJ_.jar" />
		<delete file="MMReader_.jar" />
	</target>
	
</project>