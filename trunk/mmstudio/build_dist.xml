<!-- Ant makefile for the Micro-Manager 2.0 for Windows distribution -->
<!-- This file assumes Micro-Manager2 project tree structure      -->

<project name="MMJ" default="buildMMStudio">

	<!-- Specify version in the installer name -->
	<property name="InstallerName" value="MMSetup_2_0_1"/>

	<!-- Specify the system path to the ImageJ root directory -->
	<property name="ImageJPath" value="C:/Program Files/ImageJ"/>
	<property name="InstallRoot" value="C:/projects/micromanager2/Install/micro-manager-2.0"/>
	<property name="InstallScripts" value="C:/projects/mciromanager2/Install"/>
	<property name="NativeRoot" value="C:\projects\micromanager2\MMCoreJ_wrap"/>

	<!-- Do not modify from this point on -->
	<property name="MMPluginDir" value="${ImageJPath}/plugins/Micro-Manager"/>
	<property name="IJ" value="../classext/ij.jar"/>
	<property name="beanshell" value="../classext/bsh-2.0b4.jar"/>
	<property name="MMCoreJ" value="../bin/MMCoreJ.jar"/>
	<property name="MMPluginDir-inst" value="${InstallRoot}/plugins/Micro-Manager"/>
	<property name="BinRoot" value="../bin"/>

	<path id="project.MMPlugins.path">
		<pathelement location="${MMPluginDir}"/>
	</path>

	<path id="project.run.path">
		<pathelement location="${MMPluginDir}/MMJ_.jar"/>
		<pathelement location="${MMPluginDir}/MMCoreJ.jar"/>
		<pathelement location="${MMPluginDir}/bsh-2.0b4.jar"/>
		<pathelement location="${IJ}"/>
	</path>

	<path id="project.class.path">
		<pathelement location="${IJ}" />
		<pathelement location="${beanshell}" />
		<pathelement location="${MMCoreJ}" />
	   <pathelement location="${MMPluginDir}/MMJ_.jar"/>
	</path>

	<target name="compileMMStudio" description="Compile MM Studio.">
		<mkdir dir="build" />
		<javac srcdir="./src" destdir="./build" optimize="on" source="5.0" debug="off">
			<classpath refid="project.class.path" />
		</javac>
		<copy file="./src/org/micromanager/icons/splash.gif" todir="./build/org/micromanager/icons" />
		<copy todir="./build/org/micromanager/icons">
			<fileset dir="./src/org/micromanager/icons" casesensitive="no">
				<include name="**/*.png"/>
				<include name="**/*.gif"/>
			</fileset>
		</copy>
	</target>

	<target name="buildMMStudio" description="Build MMJ_.jar">

		<copy file="./bin/plugins_mmstudio.config" tofile="./build/plugins.config"  overwrite="true" verbose="true" />
		<jar jarfile="MMJ_.jar" basedir="build" manifest="./src/MANIFEST.MF" />
		
		<mkdir dir="${MMPluginDir}" />
		<copy file="MMJ_.jar" todir="${MMPluginDir}" />
		<copy file="${beanshell}" todir="${MMPluginDir}" />
		<copy file="${MMCoreJ}" todir="${MMPluginDir}" />
	</target>
	
	<target name="buildMMReader" description="Build MMReader_.jar">
		
		<copy file="./bin/plugins_reader.config" tofile="./build/plugins.config" overwrite="true" verbose="true"/>
		<jar jarfile="MMReader_.jar" basedir="build" manifest="./src/MANIFEST.MF" />
				
	</target>

	<target name="cleanMMStudio" description="Delete the MMStudio build files.">
		<delete dir="build" />
		<delete file="MMJ_.jar" />
		<delete file="MMReader_.jar" />
	</target>
	
	<target name="install" description="Create installation image">
		<copy file="MMJ_.jar" todir="${MMPluginDir-inst}" />
		<copy file="${beanshell}" todir="${MMPluginDir-inst}" />
		<copy file="${MMCoreJ}" todir="${MMPluginDir-inst}" />
		<copy file="${BinRoot}/MMCoreJ_wrap.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_DemoCamera.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_demo.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_ZeissMTB.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_zeiss.cfg" todir="${InstallRoot}" />
		<copy file="${BinRoot}/mmgr_dal_AOTF.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_uberzeiss.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Hamamatsu.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_ham.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/inpout32.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/mmgr_dal_SerialManager.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/mmgr_dal_ParallelPort.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Ludl.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_PVCAM.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_PVCAM.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_SutterLambda.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Sensicam.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Vincent.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_NikonTE2000.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_NikonTE2000.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Nikon.dll" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Prior.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_Prior.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_DTOpenLayer.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_DTOL.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_Andor.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_Andor.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/mmgr_dal_StanfordPhotonics.dll" todir="${InstallRoot}" />
		<copy file="${BinRoot}/MMConfig_StanfordPhotonics.cfg" todir="${InstallRoot}" />

		<copy file="${BinRoot}/MMDeviceList.txt" todir="${InstallRoot}" />

		
		<copy file="${BinRoot}/conf_intro_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_comport_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_devices_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_delays_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_finish_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_labels_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_presets_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_roles_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_synchro_page.html" todir="${InstallRoot}" />
		<copy file="${BinRoot}/conf_preinit_page.html" todir="${InstallRoot}" />
		
	</target>

	<target name="packInstaller" description="Create installation package">
		<exec dir="${InstallRoot}" executable="/projects/3rdparty/Inno_Setup_5/iscc.exe">
			<arg line="/F${InstallerName} ${InstallScripts}/MM-ImageJ-Install.iss"/>
		</exec>
	</target>

	<target name="buildNative" description="Build native dlls">
		<exec dir="C:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Tools" executable="cmd">
			<arg line="/k vsvars32.bat"/>
		</exec>
		<exec dir="${NativeRoot}" executable="devenv.exe">
			<arg line="MMCoreJ_wrap.sln /REBUILD Release"/>
		</exec>
	</target>


</project>