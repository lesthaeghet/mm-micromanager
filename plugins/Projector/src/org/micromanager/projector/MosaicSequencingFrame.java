/*
 * Copyright 2014, Andor Technology, Inc.
 * Contributed as open source to the Micro-Manager
 * code base.
 * Code written by Arthur Edelstein.
 * 
 */

package org.micromanager.projector;

import ij.IJ;
import ij.ImagePlus;
import ij.gui.ImageWindow;
import ij.gui.PolygonRoi;
import ij.gui.Roi;
import ij.plugin.frame.RoiManager;
import java.awt.Polygon;
import java.awt.Rectangle;
import java.awt.Window;
import java.io.File;
import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Vector;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JComboBox;
import javax.swing.event.TableModelEvent;
import javax.swing.event.TableModelListener;
import javax.swing.table.DefaultTableModel;
import mmcorej.CMMCore;
import mmcorej.DeviceType;
import mmcorej.StrVector;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.micromanager.api.ScriptInterface;
import org.micromanager.utils.FileDialogs;
import org.micromanager.utils.GUIUtils;
import org.micromanager.utils.ReportingUtils;
import org.micromanager.utils.TextUtils;

/**
 * This code is partly generated by the Netbeans Form Editor,
 * and those parts should not be edited by hand.
 */
public class MosaicSequencingFrame extends javax.swing.JFrame {
   private class Sequence {
      Vector<Vector<String>> sequenceTableDataVector;
      int repeatCount;
   }

   private final CMMCore core_;
   private final ScriptInterface gui_;
   private final String mosaic_;
   private final int mosaicWidth_;
   private final int mosaicHeight_;
   private final ProjectorController projectorController_;
   private final DefaultTableModel sequenceTableModel_;
   private final Vector<String> headerNames = new Vector<String>(Arrays.asList(         
                           new String[] {"Time Slot", "Roi Indices", "On Duration (ms)",
                              "Off Duration (ms)", "Loop count"}));
   
   // The triggerProperties_ allow us to convert GUI names for triggering
   // to the Mosaic3 device adapter names for triggering.
   final Map<String, String> triggerProperties_ = new HashMap<String, String>() {{
         put("External Frame Bulb", "ExternalBulb");
         put("Sequence Start", "InternalExpose");
         put("External Advance", "ExternalExpose");
         put("External Start", "ExternalSequenceStart");
      }};

   // Returns all active Mosaic devices reported by the MMCore.
   public static ArrayList<String> getMosaicDevices(CMMCore core) {
      StrVector slmDevices = core.getLoadedDevicesOfType(DeviceType.SLMDevice);
      final ArrayList<String> mosaicDevices = new ArrayList<String>();
      for (final String slmDevice : slmDevices) {
         try {
            if (core.getDeviceLibrary(slmDevice).contentEquals("Mosaic3"))
               mosaicDevices.add(slmDevice);
         } catch (Exception ex) {
            ReportingUtils.logError(ex);
         }
      }
      return mosaicDevices;
   }
   
   // Alter the Time Slot indices such that the first row is
   // column 1, the second column 2, and so on.
   private void updateTimeSlotIndices(final DefaultTableModel sequenceTableModel) {
      for (int i = 0; i < sequenceTableModel.getRowCount(); ++i) {
         sequenceTableModel.setValueAt(i + 1, i, 0);
      }
   }
   
   // Ensures that the "Time Slot" column such that the first
   // row is column 1, the second is 2, and so on.
   private void keepTimeSlotIndicesUpToDate(final DefaultTableModel sequenceTableModel) {
      sequenceTableModel.addTableModelListener(new TableModelListener() {
         @Override
         public void tableChanged(TableModelEvent e) {
            sequenceTableModel.removeTableModelListener(this);
            updateTimeSlotIndices(sequenceTableModel);
            sequenceTableModel.addTableModelListener(this);
         }
      });
   }
   
   // Adds a row to the sequence table, including ROIs, an
   // on-duration period, an off-duration period, and a loop 
   // repeat count. Returns the index of the added row.
   private int addRow(DefaultTableModel sequenceTableModel, String roiIndicesString, int onDurationMs, int offDurationMs, int loopCount) {
      ArrayList<String> rows = new ArrayList<String>();
      rows.add("");
      rows.add(roiIndicesString);
      rows.add(String.valueOf(onDurationMs).trim());
      rows.add(String.valueOf(offDurationMs).trim());
      rows.add(String.valueOf(loopCount).trim());
      sequenceTableModel.addRow(rows.toArray());
      sequenceTable_.invalidate();
      return sequenceTableModel.getRowCount() - 1;
   }
   
   // Implements the Add Time Slot button. Adds the default 
   // integer values. Sends the user to edit the Frame ROIs.
   private void addTimeSlot() {
      int row = addRow(
            sequenceTableModel_,
            "",
            GUIUtils.getIntValue(onDurationTextField_),
            GUIUtils.getIntValue(offDurationTextField_),
            GUIUtils.getIntValue(loopCountTextField_));
      sequenceTable_.setRowSelectionInterval(row, row);
      GUIUtils.startEditingAtCell(sequenceTable_, row, 1);
   }
   
   // Generate a new sequence of phototargeting events.
   private void generateNewSequence(int roiCount) {
      int onDurationMs = GUIUtils.getIntValue(onDurationTextField_);
      int offDurationMs = GUIUtils.getIntValue(offDurationTextField_);
      int loopCount = GUIUtils.getIntValue(loopCountTextField_);
      String sequenceType = (String) sequenceTypeComboBox.getSelectedItem();
      sequenceTable_.clearSelection();
      sequenceTableModel_.getDataVector().clear();
      if (sequenceType.contentEquals("Simultaneous")) {
         addRow(sequenceTableModel_, "1-" + String.valueOf(roiCount).trim(), onDurationMs, offDurationMs, loopCount);
      }
      if (sequenceType.contentEquals("Sequential")) {
         for (int i = 0; i < roiCount; ++i) {
            addRow(sequenceTableModel_, String.valueOf(i + 1).trim(), onDurationMs, offDurationMs, loopCount);      
         }
      }
      if (sequenceType.contentEquals("Cumulative")) {
         for (int i = 0; i < roiCount; ++i) {
            addRow(sequenceTableModel_, i == 0 ? "1" : "1-" + String.valueOf(i + 1).trim(), onDurationMs, offDurationMs, loopCount);      
         }
      }
      updateTimeSlotIndices(sequenceTableModel_);
   }
   
   // Convert a textual representation of a set of one-based roi indices to a
   // vector of zero-based integers also representing those indices. For example,
   // "1-3,5,7,9-11" gets converted to [0,1,2,4,6,8,9,10].
   private ArrayList<Integer> frameStringToRoiIndexList(String sequenceString) {
      ArrayList<Integer> sequence = new ArrayList<Integer>();
      String[] pieces = sequenceString.split(",");
      try {
         for (String piece : pieces) {
            // First parse a range fragment, such as "2-4".
            if (piece.contains("-")) {
               String[] limits = piece.split("-");
               int min = Integer.parseInt(limits[0]);
               int max = Integer.parseInt(limits[1]);
               // If the limits are specified in reverse order, fix that.
               if (min > max) {
                  int temp = max;
                  max = min;
                  min = temp;
               }
               // Add each integer in range (inclusive) to the sequence.
               for (int i = min; i <= max; ++i) {
                  sequence.add(i - 1);
               }
            } else {
               // Parse a standalone integer.
               int value = Integer.parseInt(piece);
               sequence.add(value - 1);
            }
         }
      // Throw an exception in case we have a parse error. We'll use
      // the absence (presence) of this exception to (in)validate
      // user entries.
      } catch (NumberFormatException e) {
         throw new RuntimeException("Unable to parse frame specifier");
      }
      return sequence;
   }

   // The SequenceEvent object defines a Sequence event by a number of
   // simple parameters, including the on and off duration, the loopCount,
   // and the pixels belonging to a particular frame.
   private class SequenceEvent {
      public byte[] framePixels;
      public int onDurationMs;
      public int offDurationMs;
      public int loopCount;
   }
   
   // Read an integer from a sequenceTable_ cell.
   private int integerAt(int rowIndex, int columnIndex) {
      return Integer.parseInt(sequenceTableModel_.getValueAt(rowIndex, columnIndex).toString());
   }
   
   
   // Returns the current Rois on the live window.
   private Roi[] getRois() {
      ImageWindow win;
      try {
         win = gui_.getSnapLiveWin();
      } catch (Exception e) {
         return new Roi[0]; // empty array
      }
      return ProjectorController.getRois(win);  
   }
   
   // Get the total number of ROIs available in the Snap/Live window.
   private int getRoiCount() {
      Roi[] rois = getRois();
      return rois.length;
   }
   
   // Convert a row from the sequenceTable_ to a SequenceEvent object.
   private SequenceEvent sequenceRowToSequenceEvent(int rowIndex, Polygon[] availableRoiPolygons) {
      final ArrayList<Integer> roiIndexList = frameStringToRoiIndexList(sequenceTableModel_.getValueAt(rowIndex, 1).toString());
      SequenceEvent sequenceEvent = new SequenceEvent();
      ArrayList<Polygon> selectedRoiPolygons = new ArrayList<Polygon>();
      for (int roiIndex : roiIndexList) {
         selectedRoiPolygons.add(availableRoiPolygons[roiIndex]);
      }
      sequenceEvent.framePixels = SLM.roisToPixels(mosaicWidth_, mosaicHeight_,
                                                   selectedRoiPolygons.toArray(new Polygon[0]));
      sequenceEvent.onDurationMs = integerAt(rowIndex, 2);
      sequenceEvent.offDurationMs = integerAt(rowIndex, 3);
      sequenceEvent.loopCount = integerAt(rowIndex, 4);
      return sequenceEvent;
   }
   
   // Get a list of SequenceEvents by extracting information from the sequenceTable_.
   private ArrayList<SequenceEvent> getSequenceEvents() {
      final ImageWindow snapLiveWin = gui_.getSnapLiveWin();
      final ImagePlus snapLiveImage = snapLiveWin.getImagePlus();
      Polygon[] availableRoiPolygons = projectorController_.getTransformedRois(snapLiveImage, getRois());
      ArrayList<SequenceEvent> events = new ArrayList<SequenceEvent>();
      for (int i = 0; i < sequenceTableModel_.getRowCount(); ++i) {
         events.add(sequenceRowToSequenceEvent(i, availableRoiPolygons));
      }
      return events;
   }
   
   // Convert a series of sequence events to a string.
   private String sequenceEventsToString(final ArrayList<SequenceEvent> events) {
      String eventString = "";
      int i = 0;
      for (SequenceEvent event:events) {
         eventString += i
                       + " " + event.onDurationMs
                       + " " + event.offDurationMs
                       + " " + event.loopCount + ";";
         ++i;
      }
      return eventString;
   }
   
   // Convert a list of SequenceEvents to a list of byte arrays, each
   // corresponding to a frame in the sequence.
   private List<byte[]> imageListFromSequenceEvents(final ArrayList<SequenceEvent> events) {
      List<byte[]> imageList = new ArrayList<byte[]>();
      for (SequenceEvent event:events) {
         imageList.add(event.framePixels);
      }
      return imageList;
   }
   
   // Upload the provided SequenceEvents to the Mosaic, by using the
   // "SequenceSettings" property.
   private void uploadSequence(final ArrayList<SequenceEvent> events) {
      try {
         core_.loadSLMSequence(mosaic_, imageListFromSequenceEvents(events));      
         core_.setProperty(mosaic_, "SequenceSettings", sequenceEventsToString(events));
      } catch (Exception ex) {
         ReportingUtils.showError(ex);
      }
   }
   
   // Upload the sequence from the sequence table to the Mosaic.
   private void uploadSequence() {
      uploadSequence(getSequenceEvents());
   }

   // Show the ImageJ Roi Manager and return a reference to it.   
   private RoiManager showRoiManager() {
      IJ.run("ROI Manager...");
      return RoiManager.getInstance();
   }
   
   // Generate the ROI grid from a single ROI. The initial ROI will be located
   // in the upper left corner of the grid and the remaining ROIs will be
   // clones of that ROI, with offsets specified.
   private void generateRoiGrid() {
      RoiManager roiManager = showRoiManager();
      Roi selectedRoi = null;
      if (roiManager.getCount() == 0) {
         selectedRoi = IJ.getImage().getRoi();
      } else {
         int firstSelectedRoi = Math.max(0, roiManager.getSelectedIndex());
         selectedRoi = roiManager.getRoisAsArray()[firstSelectedRoi];
      }
      if (selectedRoi == null) {
         ReportingUtils.showError("Please draw a single ROI for duplication in a grid.");
         return;
      }
      roiManager.runCommand("reset");
      int numX = GUIUtils.getIntValue(this.numRoisAcrossField_);
      int numY = GUIUtils.getIntValue(this.numRoisDownField_);
      int spacingX = GUIUtils.getIntValue(this.roiSpacingAcrossField_);
      int spacingY = GUIUtils.getIntValue(this.roiSpacingDownField_);
      for (int j = 0; j < numY; ++j) {
         for (int i = 0; i < numX; ++i) {
            Roi newRoi = (Roi) selectedRoi.clone();
            Rectangle bounds = selectedRoi.getBounds();
            newRoi.setLocation(bounds.x + i * spacingX, bounds.y + j * spacingY);
            roiManager.addRoi(newRoi);
         }
      }     
   }

   // Create the Sequence from the sequenceTable_.
   private void generateSequence() {
      int roiCount = getRoiCount();
      if (roiCount == 0) {
         ReportingUtils.showMessage("Please draw ROIs for phototargeting.");
      }
      generateNewSequence(getRoiCount());
   }
   
   // Run the Mosaic Sequence. Called by Run button.
   private void runSequence() {
      try {
         final String selectedItem = sequenceTriggerComboBox.getSelectedItem().toString();
         core_.setProperty(mosaic_, "SequenceLoopCount", GUIUtils.getIntValue(sequenceLoopCountTextField_));
         core_.setProperty(mosaic_, "TriggerMode", triggerProperties_.get(selectedItem));
         core_.setProperty(mosaic_, "OperationMode", "FrameSequence");
         core_.startSLMSequence(mosaic_);
      } catch (Exception ex) {
         ReportingUtils.showError(ex);
      }
   }
   
   // Abort the Mosaic sequence. Called by Stop button.
   private void stopSequence() {
      try {
         core_.stopSLMSequence(mosaic_);
      } catch (Exception ex) {
         ReportingUtils.showError(ex);
      }
   }
   
   // Reads the current ROIs and returns their vertices in JSON Array.
   private JSONArray roisToJSON(Roi[] rois) {
      JSONArray allPolygons = new JSONArray();
      for (Roi roi : rois) {
         JSONArray polyPoints = new JSONArray();
         Polygon polygon = roi.getPolygon();
         for (int i = 0; i < polygon.npoints; ++i) {
            JSONArray xy = new JSONArray();
            xy.put(polygon.xpoints[i]);
            xy.put(polygon.ypoints[i]);
            polyPoints.put(xy);
         }
         allPolygons.put(polyPoints);
      }
      return allPolygons;
   }
   
   // Returns ROI objects generated by interpreting vertices from JSON.
   private Roi[] roisFromJSON(JSONArray data) {
      try {
         Vector<Roi> rois = new Vector<Roi>();
         for (int i = 0; i < data.length(); ++i) {
            Polygon poly = new Polygon();
            JSONArray points = data.getJSONArray(i);
            for (int j = 0 ; j < points.length(); ++j) {
               int x = points.getJSONArray(j).getInt(0);
               int y = points.getJSONArray(j).getInt(1);
               poly.addPoint(x,y);
            }
            Roi roi = new PolygonRoi(poly, Roi.POLYGON);
            rois.add(roi);
         }
         return rois.toArray(new Roi[0]);
      } catch (JSONException ex) {
         ReportingUtils.logError(ex);
         return new Roi[0];
      }      
   }
   
   // Convert current ROI sequence data to a JSON string.
   private String serializeToJSONString() {
      JSONObject toSave = new JSONObject();
      int columnCount = sequenceTableModel_.getColumnCount();
      int rowCount = sequenceTableModel_.getRowCount();
      JSONArray tableData = new JSONArray();
      for (int row = 0; row < rowCount; ++row) {
         JSONObject rowData = new JSONObject();
         for (int column = 0; column < columnCount; ++column) {
            try {
               headerNames.get(column);
               rowData.put(headerNames.get(column), sequenceTableModel_.getValueAt(row, column));
            } catch (JSONException ex) {
               ReportingUtils.logError(ex);
            }
         }
         tableData.put(rowData);
      }

      try {
         toSave.put("Rois", roisToJSON(getRois()));
         toSave.put("SequenceData", tableData);
         toSave.put("SequenceRepeats", GUIUtils.getIntValue(this.sequenceLoopCountTextField_));
      } catch (JSONException ex) {
         ReportingUtils.logError(ex);
      }
      return toSave.toString();
   }

   // Read ROI sequence data from a JSON string and populate window.
   private void deserializeFromJSONString(String jsonString) {
      try {
         JSONObject jsonData = new JSONObject(jsonString);
         JSONArray tableData = jsonData.getJSONArray("SequenceData");
         for (int i = sequenceTableModel_.getRowCount() - 1; i >= 0; --i) {
            sequenceTableModel_.removeRow(i);
         }
         for (int row = 0; row < tableData.length(); ++row) {
            JSONObject rowData = tableData.getJSONObject(row);
            int col = 0;
            Vector<String> newRow = new Vector<String>();
            for (String headerName : headerNames) {
               String value = rowData.getString(headerName);
               newRow.add(value);
               ++col;
            }
            sequenceTableModel_.addRow(newRow);
         }
         sequenceLoopCountTextField_.setText(String.valueOf(jsonData.getInt("SequenceRepeats")));
         Roi[] rois = roisFromJSON(jsonData.getJSONArray("Rois"));
         RoiManager roiManager = showRoiManager();
         roiManager.runCommand("reset");
         for (Roi roi:rois) {
            roiManager.addRoi(roi);
         }
      } catch (JSONException ex) {
         ReportingUtils.logError(ex);
      }
   }
   
   private  FileDialogs.FileType fileType = new FileDialogs.FileType("Mosaic", "Mosaic Sequence Description", "MosaicSequence.txt", true, "txt");   
   
   // Save the sequence settings to a file.
   private void save() {
      try {
         File theFile = FileDialogs.save(null, "Please save the Mosaic sequence file.", fileType);
         String content = serializeToJSONString();
         TextUtils.writeTextFile(theFile.getAbsolutePath(), content);
      } catch (IOException ex) {
         ReportingUtils.logError(ex);
      }
   }
   
   // Load the sequence settings from a file.
   private void load() {
      File theFile = FileDialogs.openFile(null, "Please choose a Mosaic sequence file to load.", fileType);
      try {
         deserializeFromJSONString(TextUtils.readTextFile(theFile.getAbsolutePath()));
      } catch (IOException ex) {
         ReportingUtils.showError(ex);
      }
   }
   
   // Starts the sequence when the acquisition engine starts.
   public void attachToAcquisition() {
      gui_.attachRunnable(0, 0, 0, 0, new Runnable() {
         public void run() {
            new Thread() {
               public void run() {
                  runSequence();
               }
            }.start();
         }
      });
   }
   
   // The acquisition engine will no longer run phototargeting after this
   // is called. Called by the "detach" button.
   public void detachFromAcquisition() {
      gui_.clearRunnables();
   }
   
   // Creates a new window, the MosaicSequencingFrame. This frame allows the
   // user to generate sequences of ROIs, and optionally, generate ROIs in
   // a grid pattern.
   public MosaicSequencingFrame(ScriptInterface gui, CMMCore core, ProjectorController projectorController) {
      initComponents();
      gui_ = gui;
      core_ = core;
      projectorController_ = projectorController;
      // Get the first available Mosaic device for now.
      mosaic_ = getMosaicDevices(core_).get(0);
      mosaicWidth_ = (int) core_.getSLMWidth(mosaic_);
      mosaicHeight_ = (int) core.getSLMHeight(mosaic_);
      sequenceTableModel_ = (DefaultTableModel) sequenceTable_.getModel();
      
      GUIUtils.recallPosition(this);
      GUIUtils.enforceIntegerTextField(onDurationTextField_, 0, 200000);
      GUIUtils.enforceIntegerTextField(offDurationTextField_, 0, 200000);
      GUIUtils.enforceIntegerTextField(loopCountTextField_, 0, 65535);
      GUIUtils.enforceIntegerTextField(sequenceLoopCountTextField_, 0, 65535);
      
      GUIUtils.enforceIntegerTextField(numRoisAcrossField_, 1, 30);
      GUIUtils.enforceIntegerTextField(numRoisDownField_, 1, 30);
      GUIUtils.enforceIntegerTextField(this.roiSpacingAcrossField_, 10, 1000);
      GUIUtils.enforceIntegerTextField(this.roiSpacingDownField_, 10, 1000);
      
      GUIUtils.makeIntoMoveRowUpButton(sequenceTable_, upButton);
      GUIUtils.makeIntoMoveRowDownButton(sequenceTable_, downButton);
      GUIUtils.makeIntoCloneRowButton(sequenceTable_, cloneButton);
      GUIUtils.makeIntoDeleteRowButton(sequenceTable_, deleteButton);
      GUIUtils.tabKeyTraversesTable(sequenceTable_);
      
      GUIUtils.setClickCountToStartEditing(sequenceTable_, 1);
      GUIUtils.stopEditingOnLosingFocus(sequenceTable_);

      keepTimeSlotIndicesUpToDate(sequenceTableModel_);
      
   }

   
   // Warning: code below this line should not be edited by hand.
   // Instead, use the Netbeans Form Editor to make changes.
   
   /**
    * This method is called from within the constructor to initialize the form.
    * WARNING: Do NOT modify this code. The content of this method is always
    * regenerated by the Form Editor.
    */
   @SuppressWarnings("unchecked")
   // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
   private void initComponents() {

      jLabel5 = new javax.swing.JLabel();
      jPanel1 = new javax.swing.JPanel();
      jLabel2 = new javax.swing.JLabel();
      jLabel3 = new javax.swing.JLabel();
      jLabel4 = new javax.swing.JLabel();
      onDurationTextField_ = new javax.swing.JTextField();
      offDurationTextField_ = new javax.swing.JTextField();
      loopCountTextField_ = new javax.swing.JTextField();
      sequenceTypeComboBox = new javax.swing.JComboBox();
      generateSequenceButton = new javax.swing.JButton();
      jLabel1 = new javax.swing.JLabel();
      jPanel2 = new javax.swing.JPanel();
      jScrollPane2 = new javax.swing.JScrollPane();
      sequenceTable_ = new javax.swing.JTable();
      downButton = new javax.swing.JButton();
      cloneButton = new javax.swing.JButton();
      addTimeSlotButton_ = new javax.swing.JButton();
      upButton = new javax.swing.JButton();
      deleteButton = new javax.swing.JButton();
      jLabel8 = new javax.swing.JLabel();
      jPanel3 = new javax.swing.JPanel();
      uploadButton_ = new javax.swing.JButton();
      jLabel7 = new javax.swing.JLabel();
      sequenceTriggerComboBox = new javax.swing.JComboBox();
      runButton_ = new javax.swing.JButton();
      stopButton_ = new javax.swing.JButton();
      jLabel6 = new javax.swing.JLabel();
      sequenceLoopCountTextField_ = new javax.swing.JTextField();
      jButton3 = new javax.swing.JButton();
      saveButton_ = new javax.swing.JButton();
      loadButton_ = new javax.swing.JButton();
      jButton1 = new javax.swing.JButton();
      jPanel5 = new javax.swing.JPanel();
      numRoisAcrossLabel_ = new javax.swing.JLabel();
      numRoisDownLabel = new javax.swing.JLabel();
      roisDownSpacingLabel = new javax.swing.JLabel();
      roisAcrossSpacingLabel1 = new javax.swing.JLabel();
      generateROIGridButton_ = new javax.swing.JButton();
      numRoisAcrossField_ = new javax.swing.JTextField();
      roiSpacingAcrossField_ = new javax.swing.JTextField();
      numRoisDownField_ = new javax.swing.JTextField();
      roiSpacingDownField_ = new javax.swing.JTextField();

      jLabel5.setText("jLabel5");

      setTitle("Andor Mosaic Sequencing");
      setResizable(false);

      jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "New Sequence", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11), new java.awt.Color(0, 0, 0))); // NOI18N

      jLabel2.setText("On Duration (ms)");

      jLabel3.setText("Off Duration (ms)");

      jLabel4.setText("Loop Count");

      onDurationTextField_.setText("400");

      offDurationTextField_.setText("50");

      loopCountTextField_.setText("1");

      sequenceTypeComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Sequential", "Cumulative", "Simultaneous" }));

      generateSequenceButton.setText("Generate Sequence");
      generateSequenceButton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            generateSequenceButtonActionPerformed(evt);
         }
      });

      jLabel1.setText("Sequence type:");

      javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
      jPanel1.setLayout(jPanel1Layout);
      jPanel1Layout.setHorizontalGroup(
         jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel1Layout.createSequentialGroup()
            .addGap(35, 35, 35)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel1Layout.createSequentialGroup()
                  .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING)
                     .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING)
                     .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.TRAILING))
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                  .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                     .addComponent(loopCountTextField_, javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(offDurationTextField_, javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(onDurationTextField_, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)))
               .addGroup(jPanel1Layout.createSequentialGroup()
                  .addComponent(jLabel1)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                  .addComponent(sequenceTypeComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE))
               .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                  .addComponent(generateSequenceButton)
                  .addGap(10, 10, 10)))
            .addContainerGap(33, Short.MAX_VALUE))
      );
      jPanel1Layout.setVerticalGroup(
         jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel1Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(sequenceTypeComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
               .addComponent(jLabel1))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel2)
               .addComponent(onDurationTextField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel3)
               .addComponent(offDurationTextField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel4)
               .addComponent(loopCountTextField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(generateSequenceButton)
            .addContainerGap(12, Short.MAX_VALUE))
      );

      jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Sequence", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11), new java.awt.Color(0, 0, 0))); // NOI18N
      jPanel2.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N

      sequenceTable_.setModel(new javax.swing.table.DefaultTableModel(
         new Object [][] {

         },
         new String [] {
            "Time Slot", "FRAP Regions", "On Duration (ms)", "Off Duration (ms)", "Loops"
         }
      ) {
         boolean[] canEdit = new boolean [] {
            false, true, true, true, false
         };

         public boolean isCellEditable(int rowIndex, int columnIndex) {
            return canEdit [columnIndex];
         }
      });
      sequenceTable_.getTableHeader().setResizingAllowed(false);
      sequenceTable_.getTableHeader().setReorderingAllowed(false);
      jScrollPane2.setViewportView(sequenceTable_);
      if (sequenceTable_.getColumnModel().getColumnCount() > 0) {
         sequenceTable_.getColumnModel().getColumn(0).setResizable(false);
         sequenceTable_.getColumnModel().getColumn(0).setPreferredWidth(40);
         sequenceTable_.getColumnModel().getColumn(4).setPreferredWidth(50);
      }

      downButton.setText("Down");

      cloneButton.setText("Clone");

      addTimeSlotButton_.setText("Add");
      addTimeSlotButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            addTimeSlotButton_ActionPerformed(evt);
         }
      });

      upButton.setText("Up");

      deleteButton.setText("Delete");

      jLabel8.setText("Time slot:");

      javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
      jPanel2.setLayout(jPanel2Layout);
      jPanel2Layout.setHorizontalGroup(
         jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel2Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 525, javax.swing.GroupLayout.PREFERRED_SIZE)
               .addGroup(jPanel2Layout.createSequentialGroup()
                  .addComponent(jLabel8)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                  .addComponent(addTimeSlotButton_)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(cloneButton)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(deleteButton)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(upButton)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(downButton)))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
      );
      jPanel2Layout.setVerticalGroup(
         jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel2Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 146, Short.MAX_VALUE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(cloneButton)
               .addComponent(deleteButton)
               .addComponent(upButton)
               .addComponent(downButton)
               .addComponent(addTimeSlotButton_)
               .addComponent(jLabel8))
            .addGap(11, 11, 11))
      );

      jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder()));

      uploadButton_.setText("Upload Sequences");
      uploadButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            uploadButton_ActionPerformed(evt);
         }
      });

      jLabel7.setText("Sequence Trigger:");

      sequenceTriggerComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Sequence Start", "External Start", "External Advance", "External Frame Bulb" }));

      runButton_.setText("Run");
      runButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            runButton_ActionPerformed(evt);
         }
      });

      stopButton_.setText("Stop");
      stopButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            stopButton_ActionPerformed(evt);
         }
      });

      jLabel6.setText("Sequence Repeats:");

      sequenceLoopCountTextField_.setText("1");

      jButton3.setText("Attach to Acquisition");
      jButton3.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton3ActionPerformed(evt);
         }
      });

      saveButton_.setText("Save");
      saveButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            saveButton_ActionPerformed(evt);
         }
      });

      loadButton_.setText("Load");
      loadButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            loadButton_ActionPerformed(evt);
         }
      });

      jButton1.setText("Detach");
      jButton1.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            jButton1ActionPerformed(evt);
         }
      });

      javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
      jPanel3.setLayout(jPanel3Layout);
      jPanel3Layout.setHorizontalGroup(
         jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel3Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addComponent(jLabel6)
               .addGroup(jPanel3Layout.createSequentialGroup()
                  .addComponent(runButton_)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(stopButton_)))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel3Layout.createSequentialGroup()
                  .addGap(10, 10, 10)
                  .addComponent(jButton3)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(jButton1)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                  .addComponent(loadButton_)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                  .addComponent(saveButton_))
               .addGroup(jPanel3Layout.createSequentialGroup()
                  .addComponent(sequenceLoopCountTextField_, javax.swing.GroupLayout.PREFERRED_SIZE, 47, javax.swing.GroupLayout.PREFERRED_SIZE)
                  .addGap(18, 18, 18)
                  .addComponent(jLabel7)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                  .addComponent(sequenceTriggerComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, 106, javax.swing.GroupLayout.PREFERRED_SIZE)
                  .addGap(28, 28, 28)
                  .addComponent(uploadButton_)))
            .addContainerGap())
      );
      jPanel3Layout.setVerticalGroup(
         jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel3Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(uploadButton_)
               .addComponent(jLabel7)
               .addComponent(sequenceTriggerComboBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
               .addComponent(jLabel6)
               .addComponent(sequenceLoopCountTextField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(runButton_)
               .addComponent(jButton3)
               .addComponent(saveButton_)
               .addComponent(stopButton_)
               .addComponent(loadButton_)
               .addComponent(jButton1))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
      );

      jPanel5.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "New ROI Grid", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 11), new java.awt.Color(0, 0, 0))); // NOI18N

      numRoisAcrossLabel_.setText("Number across:");

      numRoisDownLabel.setText("Number down:");

      roisDownSpacingLabel.setText("Spacing:");

      roisAcrossSpacingLabel1.setText("Spacing:");

      generateROIGridButton_.setText("Generate ROI Grid");
      generateROIGridButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            generateROIGridButton_ActionPerformed(evt);
         }
      });

      numRoisAcrossField_.setText("1");

      roiSpacingAcrossField_.setText("100");

      numRoisDownField_.setText("1");

      roiSpacingDownField_.setText("100");

      javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
      jPanel5.setLayout(jPanel5Layout);
      jPanel5Layout.setHorizontalGroup(
         jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel5Layout.createSequentialGroup()
            .addGap(55, 55, 55)
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
               .addComponent(generateROIGridButton_)
               .addGroup(jPanel5Layout.createSequentialGroup()
                  .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                     .addComponent(roisAcrossSpacingLabel1)
                     .addComponent(roisDownSpacingLabel)
                     .addComponent(numRoisDownLabel)
                     .addComponent(numRoisAcrossLabel_))
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                  .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                     .addComponent(roiSpacingAcrossField_)
                     .addComponent(numRoisAcrossField_)
                     .addComponent(numRoisDownField_)
                     .addComponent(roiSpacingDownField_, javax.swing.GroupLayout.PREFERRED_SIZE, 53, javax.swing.GroupLayout.PREFERRED_SIZE))))
            .addContainerGap(50, Short.MAX_VALUE))
      );
      jPanel5Layout.setVerticalGroup(
         jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(jPanel5Layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(numRoisAcrossLabel_)
               .addComponent(numRoisAcrossField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGap(3, 3, 3)
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(roisAcrossSpacingLabel1)
               .addComponent(roiSpacingAcrossField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(numRoisDownLabel)
               .addComponent(numRoisDownField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(roisDownSpacingLabel)
               .addComponent(roiSpacingDownField_, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(generateROIGridButton_)
            .addContainerGap())
      );

      javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
      getContentPane().setLayout(layout);
      layout.setHorizontalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(layout.createSequentialGroup()
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
               .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
               .addGroup(layout.createSequentialGroup()
                  .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
               .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addContainerGap())
      );
      layout.setVerticalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
               .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
               .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap())
      );

      jPanel2.getAccessibleContext().setAccessibleName("Sequences");

      pack();
   }// </editor-fold>//GEN-END:initComponents

   private void generateSequenceButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_generateSequenceButtonActionPerformed
      generateSequence();
   }//GEN-LAST:event_generateSequenceButtonActionPerformed

   private void runButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_runButton_ActionPerformed
      runSequence();
   }//GEN-LAST:event_runButton_ActionPerformed

   private void stopButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_stopButton_ActionPerformed
      stopSequence();
   }//GEN-LAST:event_stopButton_ActionPerformed

   private void addTimeSlotButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addTimeSlotButton_ActionPerformed
      addTimeSlot();
   }//GEN-LAST:event_addTimeSlotButton_ActionPerformed

   private void uploadButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_uploadButton_ActionPerformed
      uploadSequence();
   }//GEN-LAST:event_uploadButton_ActionPerformed

   private void generateROIGridButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_generateROIGridButton_ActionPerformed
      generateRoiGrid();
   }//GEN-LAST:event_generateROIGridButton_ActionPerformed

   private void loadButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loadButton_ActionPerformed
      load();
   }//GEN-LAST:event_loadButton_ActionPerformed

   private void saveButton_ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButton_ActionPerformed
      save();
   }//GEN-LAST:event_saveButton_ActionPerformed

   private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
      attachToAcquisition();
   }//GEN-LAST:event_jButton3ActionPerformed

   private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
      detachFromAcquisition();
   }//GEN-LAST:event_jButton1ActionPerformed


   // Variables declaration - do not modify//GEN-BEGIN:variables
   private javax.swing.JButton addTimeSlotButton_;
   private javax.swing.JButton cloneButton;
   private javax.swing.JButton deleteButton;
   private javax.swing.JButton downButton;
   private javax.swing.JButton generateROIGridButton_;
   private javax.swing.JButton generateSequenceButton;
   private javax.swing.JButton jButton1;
   private javax.swing.JButton jButton3;
   private javax.swing.JLabel jLabel1;
   private javax.swing.JLabel jLabel2;
   private javax.swing.JLabel jLabel3;
   private javax.swing.JLabel jLabel4;
   private javax.swing.JLabel jLabel5;
   private javax.swing.JLabel jLabel6;
   private javax.swing.JLabel jLabel7;
   private javax.swing.JLabel jLabel8;
   private javax.swing.JPanel jPanel1;
   private javax.swing.JPanel jPanel2;
   private javax.swing.JPanel jPanel3;
   private javax.swing.JPanel jPanel5;
   private javax.swing.JScrollPane jScrollPane2;
   private javax.swing.JButton loadButton_;
   private javax.swing.JTextField loopCountTextField_;
   private javax.swing.JTextField numRoisAcrossField_;
   private javax.swing.JLabel numRoisAcrossLabel_;
   private javax.swing.JTextField numRoisDownField_;
   private javax.swing.JLabel numRoisDownLabel;
   private javax.swing.JTextField offDurationTextField_;
   private javax.swing.JTextField onDurationTextField_;
   private javax.swing.JTextField roiSpacingAcrossField_;
   private javax.swing.JTextField roiSpacingDownField_;
   private javax.swing.JLabel roisAcrossSpacingLabel1;
   private javax.swing.JLabel roisDownSpacingLabel;
   private javax.swing.JButton runButton_;
   private javax.swing.JButton saveButton_;
   private javax.swing.JTextField sequenceLoopCountTextField_;
   private javax.swing.JTable sequenceTable_;
   private javax.swing.JComboBox sequenceTriggerComboBox;
   private javax.swing.JComboBox sequenceTypeComboBox;
   private javax.swing.JButton stopButton_;
   private javax.swing.JButton upButton;
   private javax.swing.JButton uploadButton_;
   // End of variables declaration//GEN-END:variables
}
